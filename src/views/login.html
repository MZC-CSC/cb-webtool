<!doctype html>
<html lang="ko">
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="format-detection" content="telephone=no">
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=yes,target-densitydpi=medium-dpi" />
		<title>CLOUD BARISTA</title>
		
		<link rel="stylesheet" href="/assets/js/bootstrap-4.5.2/css/bootstrap.min.css"/>
		<link rel="stylesheet" href="/assets/css/login.css"/>
		
		<script src="/assets/js/jquery-1.11.0/jquery.min.js"></script>
		<script src="/assets/js/bootstrap-4.5.2/js/bootstrap.min.js"></script>
		<script src="/assets/js/jquery.scrollbar.js"></script>
		<script src="/assets/js/jquery.nice-select.min.js"></script>
		<script src="/assets/js/common.js"></script>
		<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
		<!--[if lt IE 9]><script src="../js/html5shiv.js"></script><![endif]-->
	 </head>
     <body class="bg_login">
 	
        <div class="loginarea">
        
            <div class="logintop">
               <div class="loginbox">
                   
                   <div class="loginlogo"><img src="/assets/img/common/img_login_t.png" alt="Cloud Barista"></div>
                   <div class="title"><span>C</span>loud <span>B</span>arista</div>
                   <!-- Input -->
                   <div class="ipbox">
                       <ul>
                           <li class="form-label-group"><label class>Account(ID)</label><input type="text" name="" id="email" value="" placeholder="Input /Account(ID)" title="" autofocus /></li>
                           <li class="form-label-group"><label>Password</label><input type="password" name="" id="password" value="" placeholder="Input /Password (*****)" title="" onkeydown="enterkey();"/></li>
                       </ul>
                       <div class="ch"><input type="checkbox" name="" value="" id="ip_ch" title="" /><label for="ip_ch"><span></span> Remenber me</label></div>
                       <div class="btnbox">
                           <div class="btn_pw"><a href="#">Lost your password?</a>  <span>I</span> <a href="#">Sign Up</a></div>
                           <button name="" value="" class="btn_login" data-toggle="modal" data-target id="sign_btn">Login</button> 
                       </div>
                   </div>
                   <!-- //Input -->
               </div>	
           </div>
       
           <div class="login_footer">
               
               <div class="infobox">
                   
                   <div class="tit">Cloud-Barista Community</div>
                   <div class="listbox">
                       <div class="linkbox">
                           <p>Homepage :</p>
                           <div class="txt"><a href="https://cloud-barista.github.io" target="_blank">https://cloud-barista.github.io</a></div>
                       </div>
                       <div class="linkbox">
                           <p>GitHub :</p>
                           <div class="txt"><a href="https://github.com/cloud-barista" target="_blank">https://github.com/cloud-barista</a></div>
                       </div>
                   </div>
                   <div class="linkbox">
                       <p>E-mail :</p>
                       <div class="txt"><a href="mailto:contact-to-cloud-barista@googlegroups.com" target="_blank">contact-to-cloud-barista@googlegroups.com</a></div>
                   </div>
                   
               </div>
               
           </div>
           
       </div>
       
       <!-- required -->
       <div class="modal fade" id="required" tabindex="-1" role="dialog" aria-hidden="true">
           <div class="modal-dialog" role="document">
               <div class="modal-content">
                   
                   <div class="modal-body">
                       <div class="txt">ID/Password required !</div>
                       <div class="btnbox">
                           <button type="button" class="btn_ok" data-toggle="modal" data-target="#idpwLost">OK</button>
                       </div>
                   </div>
                   
               </div>
           </div>
                   
       </div>
       <!-- //required -->
       
       <!-- id/password lost -->
       <div class="modal fade" id="idpwLost" tabindex="-1" role="dialog" aria-hidden="true">
           <div class="modal-dialog" role="document">
                   <div class="modal-content">
                       
                   
                   <div class="modal-body">
                       <div class="txt"><span>Illegal account / password</span> 다시 입력 하시겠습니까?</div>
                       <div class="btnbox">
                           <button type="button" class="btn_cancel" data-dismiss="modal">Cancel</button>
                           <button type="button" class="btn_ok" data-toggle="modal" data-target="#popLogin">OK</button>
                       </div>
                   </div>
               </div>
           </div>
                   
       </div>
       <!-- //id/password lost -->
       
       <!-- Cloud Connection / Select NS (NameSpace) input -->
       <div class="modal fade" id="popLogin" tabindex="-1" role="dialog" aria-hidden="true">
           
           <div class="modal-dialog popupBody">
               <div class="modal-content">
                   
                   <div class="modal-body scrollbar-inner">
                           
                       <div class="wbox">	
                           
                           <!-- Cloud Connection -->
                           <div class="popbox popboxCO">
                               <div class="popcont">
                                   <div class="titlebox">
                                       <div class="tit"><span>Select Cloud</span> Connection</div>
                                       <div class="txt">대상 클라우드 연결을 선택 또는 생성해 주세요</div>
                                   </div>
                                   
                                   <!-- list -->
                                   <div class="cloudlist">
                                       <div class="listbox scrollbar-inner">
                                           
                                           <div class="list">
                                               <div class="stit">Cloud Connection 1</div>
                                               <div class="stxt">Cloud Provider / Region</div>
                                           </div>	
                                           
                                           
                                               
                                       </div>
                                   </div>
                                   <!-- //list -->
                                   
                                   <!-- add -->
                                   <div class="addbox">
                                       <div class="txt">or <span>Add</span> new Connection</div>
                                       <button name="" value="" class="btn_add">ADD +</button> 
                                   </div>
                                   
                                   <div class="add_ipbox">
                                       
                                       <div class="iplist">
                                           <ul>
                                               <li><label class="chk">Type New Config Name</label><input type="text" name="" value="" placeholder="Input Name" title="" /></li>
                                               <li>
                                                   <label class="chk">Period</label>
                                                   <select title="" >
                                                       <option>Select Driver</option>
                                                   </select>
                                               </li>
                                               <li>
                                                   <label class="chk">Select Credential</label>
                                                   <select title="" >
                                                       <option>Input Name</option>
                                                   </select>
                                               </li>
                                               <li>
                                                   <label class="chk">Select Region</label>
                                                   <select title="" class="select" >
                                                       <option>Select Driver</option>
                                                       <option>Select Driver</option>
                                                       <option>Select Driver</option>
                                                       <option>Select Driver</option>
                                                       <option>Select Driver</option>
                                                       <option>Select Driver</option>
                                                   </select>
                                               </li>
                                           </ul>
                                       
                                           <div class="btnbox">
                                               <button name="" value="" class="btn_create">Create</button>
                                               <button name="" value="" class="btn_clear">Clear</button>
                                           </div>
                                           
                                       </div>
                                       
                                   </div>
                                   <!-- //add -->
                                   
                               </div>
                           </div>
                           <!-- //Cloud Connection -->
                           
                           <div class="arr"></div>
                           
                           <!-- Select NS (NameSpace) -->
                           <div class="popbox popboxNS">
                               <div class="popcont">
                                   <div class="titlebox">
                                       <div class="tit"><span>Select NS</span> (NameSpace)</div>
                                       <div class="txt">사용자의 작업 영역을 선택 또는 생성해 주세요</div>
                                   </div>
                                   
                                   <!-- list -->
                                   <div class="cloudlist">
                                       <div class="listbox scrollbar-inner" id="nsList">
                                           
                                           
                                               
                                       </div>
                                   </div>
                                   <!-- //list -->
                                   
                                   <!-- add -->
                                   <div class="addbox">
                                       <div class="txt">or <span>Add</span> new NameSpace</div>
                                       <button name="" value="" class="btn_add">ADD +</button> 
                                   </div>
                                   
                                   <div class="add_ipbox">
                                       
                                       <div class="iplist">
                                           <ul>
                                               <li><label class="chk">Type New NS Name</label><input type="text" name="" value="" placeholder="Input Name" title="" /></li>
                                               <li>
                                                   <label>Type Description</label>
                                                   <textarea  cols="" rows="" placeholder="Input Description" title=""></textarea>
                                               </li>
                                           </ul>
                                       
                                           <div class="btnbox">
                                               <button name="" value="" class="btn_create">Create</button>
                                               <button name="" value="" class="btn_clear">Clear</button>
                                           </div>
                                           
                                       </div>
                                       
                                   </div>
                                   <!-- //add -->
                                   
                               </div>
                           </div>
                           <!-- //Select NS (NameSpace) -->
                           
                       </div>
                       
                       
                       <button name="" value="" class="btn_ok" data-dismiss="modal" onclick="location.href='operation/Dashboard_Ns.html'">OK</button> 
                       
                   </div>
                   
               </div>
               
           </div>
           
       </div>
       <!-- //Cloud Connection / Select NS (NameSpace) input -->
       
      
   
    </body>
</html>
<script>

function enterkey() {
        if (window.event.keyCode == 13) {
 
             // 엔터키가 눌렸을 때 실행할 내용
             $("#sign_btn").click();
        }
}


$(document).ready(function(){
   // var apiInfo = ApiIn
   var apiInfo = "{{ .apiInfo}}";
   console.log("api Info : ", apiInfo)
    axios.post("/regUser",{headers: { 'Content-type': 'application/json',
    'Authorization': apiInfo, }
     }).then(result =>{
            console.log(result);
        });
   // var nsUrl = "http://localhost:1234/"
    $("#sign_btn").on("click",function(){
        
        try{
        // alert("test")
            var username = $("#email").val();
            var password = $("#password").val();
            if(!password || !username){
                $("#sign_btn").attr("data-target","#required")
                return;
            }
            if (password && username){
               
            }
            var req = {
                username : username,
                password : password,
            };
            console.log(req)
            axios.post("/login/proc",{headers: { 'Content-type': 'application/json', 'Authorization': apiInfo,}
            ,username:username,password:password }).then(result =>{
                console.log(result);
                if(result.status == 200){
                    
                    
                    alert("Login Success");
                    $("#popLogin").modal()
                   
                    //location.reload(true);
                    var url = "{{ .comURL.TumbleBugURL}}"+"/ns";
                    
                    axios.get(url,{
                        headers:{
                            'Authorization': apiInfo
                        }
                    }).then(result=>{
                        console.log("get NameSpace Data : ",result.data);
                        var data = result.data.ns;
                        var html = ""
                        if(data.length){
                         
                           data.filter((list)=> list.name !== "" ).map((item,index)=>{
                                html += '<div class="list">'
                                    +'<div class="stit">'+item.name+'</div>'
                                    +'<div class="stxt">'+item.description+' </div>'
                                    +'</div>'
                                return html
                            
                            })
                            
                         
                            console.log("NS data : ",data)
                            console.log("NS data : ",html)
                            $("#nsList").empty();
                            $("#nsList").append(html);
                            $(".popboxNS .cloudlist .list").each(function () {
                            $(this).click(function () {
                                var $list = $(this);
                                var $ok = $(".btn_ok");
                                    $ok.fadeIn();
                                $list.addClass('selected');
                                $list.siblings().removeClass("selected");
                                $list.off("click").click(function(){
                                        if( $(this).hasClass("selected") ) {
                                            $ok.stop().fadeOut();
                                            $list.removeClass("selected");
                                    } else {
                                            $ok.stop().fadeIn();
                                            $list.addClass("selected");
                                            $list.siblings().removeClass("selected");
                                    }
                                });
                             });
});
                        }
                        var ns = "";
                        console.log("namespace data :",data);
                        if(data){ 
                            if (data[0].id) {
                                for(var i in data){
                                    if(i == 0){
                                        ns = data[i].id
                                    }
                                }
                            }else{
                                ns = data[1].id;
                            }
                        }else{
                            alert("NameSpace가 등록되어 있지 않습니다.\n등록페이지로 이동합니다.")
                            //location.href ="/NS/reg";
                         //   $("#sign_btn").attr("data-target","#popLogin")
                        }
                        if(data){
                            $.ajax({
                            url:"/SET/NS/"+ns,
                            type:'GET',
                            async:false,
                            success:function(res){
                                console.log(res)
                            }

                        })
                            //location.href ="/dashboard";
                            //$("#sign_btn").attr("data-target","#popLogin")
                        }else{
                            alert("NameSpace가 등록되어 있지 않습니다.\n등록페이지로 이동합니다.")
                            //location.href ="/NS/reg";
                           // $("#popLogin").modal()
                        }
                    })  
                    .catch(function (error) {
                        if (error.response) {
                            // 서버가 2xx 외의 상태 코드를 리턴한 경우
                        //error.response.headers / error.response.status / error.response.data
                            alert("There is a problem communicating with cb-tumblebug server\nCheck the cb-tumblebug server\nCall Url : " + url + "\nStatus Code : " + error.response.status);
                        }
                        else if (error.request) {
                            // 응답을 못 받음
                            alert("No response was received from the cb-tumblebug server.\nCheck the cb-tumblebug server\nCall Url : " + url);
                        }
                        else {
                            alert("Error communicating with cb-tumblebug server.\n" + error.message);
                        }
                        //console.log(error.config);
                    })
                }else{
                    alert("ID or PASSWORKD MISMATCH!!Check yourself!!")
                    location.reload(true);

                }
            }).catch(function(error){
                console.log("login error : ",error);
                alert("ID or PASSWORKD MISMATCH!!Check yourself!!")
                location.reload(true);
            })
            // $.ajax({
            //     url:"/login/proc/",
            //     contentType: "application/json",
            //     data:req,
            //     method:"POST",
            

            // }).done(function(data){
            //     console.log(data)
            // });
        }catch(e){
                alert(e);
        }

    })
   
})


</script>
 <script>
    $(function() {
      return $(".modal").on("show.bs.modal", function() {
        var curModal;
        curModal = this;
        $(".modal").each(function() {
          if (this !== curModal) {
            $(this).modal("hide");
          }
        });
      });
    });		

    /* scroll */
    $(document).ready(function(){
        $('.scrollbar-inner').scrollbar();

        if($(window).width() > 1024) {
            $("#popLogin .modal-body").removeClass("scrollbar-inner");
        } else {
            $("#popLogin .modal-body").addClass("scrollbar-inner");
        }
    
        $(window).resize(function (){
            if($(window).width() > 1024) {
                $("#popLogin .modal-body").removeClass("scrollbar-inner");
            } else {
                $("#popLogin .modal-body").addClass("scrollbar-inner");
            }
        });
    });

    $(".popboxCO .cloudlist .list").each(function () {
        $(this).click(function () {
            var $list = $(this);
            var $popboxNS = $(".popboxNS");
            var $arr = $('#popLogin .arr');
            var $ok = $(".btn_ok");
                $popboxNS.fadeIn();
                $arr.fadeIn();
            $list.addClass('selected');
            $list.siblings().removeClass("selected");
            $list.off("click").click(function(){
                    if( $(this).hasClass("selected") ) {
                        $popboxNS.stop().fadeOut();
                        $arr.stop().fadeOut();
                        $ok.stop().fadeOut();
                        $list.removeClass("selected");
                } else {
                        $popboxNS.stop().fadeIn();
                        $arr.stop().fadeIn();
                        $list.addClass("selected");
                        $list.siblings().removeClass("selected");
                }
                });
        });
        });


  

    
    $(".popbox").each(function(){
        var $ipbox = $(this);
        var $add_ipbox = $ipbox.find('.add_ipbox');
        $ipbox.find('.btn_add').click(function(){
            if( $(this).html() == 'ADD +' ) {
          $(this).html('HIDE -');
                $add_ipbox.fadeIn();
        } else {
          $(this).html('ADD +');
                $add_ipbox.fadeOut();
        }
        });
    });
</script>